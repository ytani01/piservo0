# JSONコマンド リファレンス

このドキュメントは、`piservo0`ライブラリの `ThreadMultiServo` クラスおよび `Web JSON API` で使用されるJSON形式のコマンドについて詳述します。

コマンドは、単一のJSONオブジェクト、または複数のコマンドを順に実行するためのJSONオブジェクトの配列として送信できます。

## 基本書式

各コマンドは、`"cmd"`キーを持つJSONオブジェクトです。`"cmd"`の値によって動作が決まり、その他のキーで動作のパラメータを指定します。

```json
{
  "cmd": "コマンド名",
  "パラメータ1": 値1,
  "パラメータ2": 値2,
  ...
}
```

---

## コマンド一覧

### サーボモーターの制御

#### `move_angle_sync`

複数のサーボモーターを、指定した時間をかけて目標角度まで同期しながら滑らかに移動させます。

- **パラメータ:**
  - `target_angles` (list[float | str | None]): **必須**。各サーボの目標角度をリストで指定します。
    - `float`: -90.0 から 90.0 までの角度。
    - `str`: `"min"`, `"center"`, `"max"` のいずれか。
    - `None`: 現在の角度を維持（動かさない）。
  - `move_sec` (float, optional): 移動にかける時間（秒）。省略した場合は、`move_sec`コマンドで設定されたデフォルト値が使われます。
  - `step_n` (int, optional): 移動の滑らかさ（ステップ数）。省略した場合は、`step_n`コマンドで設定されたデフォルト値が使われます。

- **例:**
  ```json
  {
    "cmd": "move_angle_sync",
    "target_angles": [90, "center", -45, None],
    "move_sec": 1.5
  }
  ```

#### `move_angle`

複数のサーボモーターを、目標角度まで即座に移動させます。同期は行われません。

- **パラメータ:**
  - `target_angles` (list[float | str | None]): **必須**。`move_angle_sync`と同様。

- **例:**
  ```json
  {
    "cmd": "move_angle",
    "target_angles": [0, 90, -90, 0]
  }
  ```

#### `move_pulse`

複数のサーボモーターを、指定されたパルス幅に直接移動させます。キャリブレーション設定を無視して、ハードウェアの限界値まで動かすことができます。

- **パラメータ:**
  - `pulses` (list[int | None]): **必須**。各サーボの目標パルス幅をリストで指定します。通常、500から2500の範囲です。`None`は現在のパルス幅を維持します。

- **例:**
  ```json
  {
    "cmd": "move_pulse",
    "pulses": [500, null, 1500, 2500]
  }
  ```

### 動作設定

#### `move_sec`

`move_angle_sync`コマンドのデフォルトの移動時間（`move_sec`）を設定します。

- **パラメータ:**
  - `sec` (float): **必須**。デフォルトの移動時間（秒）。

- **例:**
  ```json
  {
    "cmd": "move_sec",
    "sec": 0.2
  }
  ```

#### `step_n`

`move_angle_sync`コマンドのデフォルトのステップ数（`step_n`）を設定します。

- **パラメータ:**
  - `n` (int): **必須**。デフォルトのステップ数。

- **例:**
  ```json
  {
    "cmd": "step_n",
    "n": 30
  }
  ```

#### `interval`

各コマンドの実行後に自動的に挿入される待機時間（インターバル）を設定します。

- **パラメータ:**
  - `sec` (float): **必須**。待機時間（秒）。

- **例:**
  ```json
  {
    "cmd": "interval",
    "sec": 0.1
  }
  ```

### 実行制御

#### `sleep`

指定された時間、コマンドの実行を一時停止します。

- **パラメータ:**
  - `sec` (float): **必須**。待機時間（秒）。

- **例:**
  ```json
  {
    "cmd": "sleep",
    "sec": 1.0
  }
  ```

#### `cancel`

コマンドキューに溜まっている未実行のコマンドをすべてキャンセル（破棄）します。

- **パラメータ:** なし

- **例:**
  ```json
  {
    "cmd": "cancel"
  }
  ```
